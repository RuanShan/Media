<%= content_for :step do %>
<div class="step-pane active" id="step1">
  <div class="row">
    <%= render 'weixin_preview', wx_title: @activity.name, wx_summary: @activity.summary %>
    <%= form_for @activity, :url => @activity.new_record? ? waves_path : wave_path(@activity), validate: true, html: {class: 'form col-sm-7'} do |activity| %>
    <%= activity.hidden_field :wx_mp_user_id, value: current_user.wx_mp_user.id %>
    <%= activity.hidden_field :supplier_id, value: current_user.id %>
    <div class="form-group">
      <label class="control-label">活动触发关键词<span class="required-star">*</span><span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="用于公众账号中触发活动，不能同其他关键词重复"> </span></label>
      <div class="clearfix">
        <%= activity.text_field :keyword, class: 'col-xs-6', id: 'keyword', placeholder: '请输入回复关键词' %>
      </div>
    </div>

    <div class="form-group">
      <label class="control-label">活动名称<span class="required-star">*</span><span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="不能超过64个字"> </span></label>
      <div class="clearfix">
        <%= activity.text_field :name, class: 'col-xs-6', id: 'wx_title',  maxlength: 64 %>
      </div>
    </div>

   <div class="form-group">
    <label class="control-label">微信消息图<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="发送关键词后返回的微信消息图片"></span></label>
    <div class="clearfix">
      <div data-name="activity[qiniu_pic_key]" data-img = "<%= @activity.pic_url %>" data-key="<%= @activity.qiniu_pic_key  %>" class="cieldon-file width-100px" data-type="1" data-div="#img-1" data-height="200"></div>
      <small class="help-inline text-warning line-height-30">图片建议尺寸：720像素*400像素</small>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label">微信消息摘要<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="发送关键词后返回的开始微信消息摘要，不能超过255个字"></span></label>
    <div class="clearfix">
      <%= activity.text_area :summary, rows: 5, class: 'form-control', id: 'wx_summary', placeholder: '请输入微信消息摘要', maxlength: 255 %>
    </div>
  </div>

  <div class="form-group">
      <label class="control-label">活动说明</label>
      <div class="clearfix">
          <%= render "shared/form_rich_text", field_name: "description", obj: activity.object, f: activity, wrapper_html_options: {class: "col-md-11 activity_notice_description"}%>
      </div>
  </div>

  <div class="form-group">
    <label class="control-label">活动时间<span class="icon-question-sign" data-rel="popover" data-trigger="hover" data-placement="right" data-content="活动时间活动开始和结束时间，非必填"> </span></label>
    <div class="clearfix">
      <div class="input-daterange input-group col-xs-6 no-padding">
        <%= datetime_range_tag activity, options: {class: 'datetimerange col-sm-12'} %>
      </div>
    </div>
  </div>

  <div class="form-group">
    <label class="control-label">自定义活动背景</label>
    <div class="clearfix">
      <div data-name="activity[bg_pic_key]" data-img = "<%= @activity.bg_pic_url  || '/assets/img/lottery/index_bg.jpg' %>" data-key="<%= @activity.bg_pic_key  %>" class="cieldon-file" data-type="0" data-width="160" data-height="284"></div>
      <span class="text-warning pull-left display-block margin-top-20 line-height-32">图片建议尺寸：640像素*1136像素</span>
    </div>
  </div>

  <div class="row-fluid">
    <%- if @activity.can_not_edit? %>
    <a href="<%= edit_prize_settings_wave_path(@activity) %>" class="btn btn-primary btn-sm btn-next"><i class="icon-arrow-right icon-on-right"></i>下一步</a>
    <%- else %>
    <button class="btn btn-primary btn-sm btn-next" data-last="完成">
      下一步
      <i class="icon-arrow-right icon-on-right"></i>
    </button>
    <%- end %>
    <% if @activity.persisted? %>
      <a href="javascript:;" class="btn btn-sm" data-toggle="div" data-target="#show_qrcode">预览</a>
    <%-  end %>
  </div>
  <div class="hide" id="show_qrcode" style="margin-top: -260px;">
    <img src='<%= "http://qr.liantu.com/api.php?w=200&text=http://#{Settings.mhostname}/#{current_user.id}/waves?aid=#{@activity.try(:id)}&simulate=simulate" %>' alt=""/>
    <div>扫描二维码预览</div>
  </div>
  <%- end %>
</div>
</div>
<% end %>
<%= render 'main_content' %>
<% content_for :custom_js do %>
<script>
  $(function() {
    <%- if @activity.can_not_edit? %>
    $('input,select,textarea').prop('disabled', true);
    $('.wysiwyg-editor').attr('contenteditable', false);
    <%- end %>
    $('form').validate();
  });

</script>
<% end %>