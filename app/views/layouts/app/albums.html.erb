<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="user-scalable=no, initial-scale=1.0, maximum-scale=1.0, width=device-width">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta content="black" name="apple-mobile-web-app-status-bar-style">
  <meta name="format-detection" content="telephone=no">
  <meta content="telephone=no" name="format-detection">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
  <title>微相册-首页</title>
  <link type="text/css" rel="stylesheet" href="/stylesheets/albums/common.css"/>
  <link type="text/css" rel="stylesheet" href="/stylesheets/albums/wphoto.css" media='screen' />
  <%= javascript_include_tag 'jquery' %>
  <script src="/javascripts/app/albums/lib/blocksit.min.js"></script>
  <%= yield :head %>
  <%= csrf_meta_tags %>
</head>
  <body>
  <%= render 'application/gb2big5' %>
    <div class="html">
      <div class="main">
        <%= yield %>
      </div>
    </div>

    <%= render 'app_footer' %>
    
  </body>

  <script src="/javascripts/app/albums/lib/underscore-min.js"></script>
  <script src="/javascripts/app/albums/lib/backbone-min.js"></script>
  <script src="/javascripts/app/albums/lib/jquery.hammer.min.js"></script>
  <script src="/javascripts/app/albums/common.js"></script>
  <script>
    $(function(){

        // preload('image1.jpg,image2.jpg,image3.jpg');
        <% string = '' %>
        <% if !!@album %>
          <% @album.photos.each do |photo| %>
          <% string += photo.pic.try(:to_s) %> 
          <% string += ',' %>
          <% end %>
        <% end %>

        if(<%= !!@album %>){
          preload('<%=string %>');
        }

       funA();
        /*$(document).on("touchend",function(){
            var maxH=$("#container").height()/2,
                scrollTop=$(this).scrollTop();
            if(scrollTop>=maxH){
                alert("刷到底了");
            }
        })*/
        
    });

    function funA(){
       $('#container').BlocksIt({
            numOfCol: 2
        });
       window.addEventListener("orientationchange", orientationHandler, false);
      setTimeout('funA()', 1000);
    }


    function orientationHandler() {       
        var url=window.location;
        window.location.href=url;
    }
    function preload(images) {
      if (document.images) {
        var i = 0;
        var imageArray = new Array();
        imageArray = images.split(',');
        var imageObj = new Image();
        for(i=0; i<=imageArray.length-1; i++) {
            //document.write('<img src="' + imageArray[i] + '" />');// Write to page (uncomment to check images)
            imageObj.src=imageArray[i];
        }
      }
    }
  </script>

</html>