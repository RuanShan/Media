<script src="http://lib.sinaapp.com/js/jquery/1.7.2/jquery.min.js"></script>
<script type="text/javascript">
function fetch_and_goto_pay_url() {
  $.ajax({
    url: '<%= payment_request_payments_url %>',
    data: <%=raw @payment_request_params.to_json %>,
    type: 'post',
    success: function(data, status) {
      pay_url = data["pay_url"];
      // alert("pay_url is" + pay_url)
      if (typeof(pay_url) != 'undefined'){
        window.location.href= pay_url;
      } else {
        alert('支付失败');
      }
    }
  });
}

fetch_and_goto_pay_url();
</script>